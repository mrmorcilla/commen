<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>CommenApp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f4f4f4;
      color: #333;
    }
    header {
      background: #333;
      color: white;
      padding: 20px;
      text-align: center;
    }
    main {
      padding: 20px;
      max-width: 900px;
      margin: auto;
      background: white;
    }
    h2 {
      color: #444;
      border-bottom: 2px solid #ddd;
      padding-bottom: 5px;
    }
    .section {
      margin-bottom: 30px;
    }
    img {
      max-width: 100%;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    footer {
      background: #333;
      color: white;
      text-align: center;
      padding: 15px;
      margin-top: 40px;
    }
    a {
      color: #1e90ff;
    }
    code {
      background: #eee;
      display: block;
      padding: 10px;
      margin: 10px 0;
      font-size: 0.9em;
      word-wrap: break-word;
    }
    button {
      background: #1e90ff;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #006fd0;
    }
    #resultado p {
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <header>
    <h1>CommenApp</h1>
    <p>Proyecto para que los usuarios puedan comentar de manera gratuita y eficaz.</p>
  </header>

  <main>
    <div class="section">
      <h2>¬øDe qu√© se trata?</h2>
      <p>Este proyecto busca resolver el problema de <strong>la falta de herramientas para comentar en los sitios web</strong> utilizando <em>este sitio</em>. Es ideal para quienes quieren ampliar sus posibilidades, compartir y aplicar conocimientos.</p>
    </div>

    <div class="section">
      <h2>Caracter√≠sticas principales</h2>
      <ul>
        <li>Funciona en todos los navegadores modernos</li>
        <li>Interfaz simple e intuitiva</li>
        <li>100% personalizable</li>
        <li>Aplicable con un simple iframe</li>
      </ul>
    </div>

    <div class="section">
      <h2>¬øC√≥mo se ve?</h2>
      <img src="https://via.placeholder.com/800x400?text=Vista+de+comentarios+CommenApp" alt="Captura del proyecto">
    </div>

    <div class="section">
      <h2>C√≥mo usarlo</h2>
      <ol>
        <li>Haz clic en el bot√≥n para generar un nuevo ID de comentarios</li>
        <li>Copia el iframe generado</li>
        <li>P√©galo en tu p√°gina web donde quieras que aparezcan los comentarios</li>
      </ol>
      <button onclick="generarNuevaSeccion()">üÜï Generar nueva secci√≥n</button>
      <div id="resultado"></div>
    </div>

    <div class="section">
      <h2>Contacto</h2>
      <p>¬øTienes preguntas o sugerencias? Escr√≠beme a <a href="mailto:agmorillofigueroa@escuelasproa.edu.ar">@correo</a></p>
    </div>
  </main>

  <footer>
    &copy; 2025 CommenApp. Todos los derechos reservados.
  </footer>

  <!-- Firebase + funciones -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBNB1pie7adM_1kpmqYQaTN38OBSwmqd8A",
      authDomain: "comentarois.firebaseapp.com",
      databaseURL: "https://comentarois-default-rtdb.firebaseio.com",
      projectId: "comentarois",
      storageBucket: "comentarois.appspot.com",
      messagingSenderId: "1074326048901",
      appId: "1:1074326048901:web:98ceed4e2aa8b2026b59ec"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    async function generarNuevaSeccion() {
      const resultadoDiv = document.getElementById("resultado");
      resultadoDiv.innerHTML = "üîç Buscando ID libre...";

      try {
        const snapshot = await get(ref(db, 'comentarios'));
        const usados = snapshot.exists() ? Object.keys(snapshot.val()) : [];

        let nuevoId = 0;
        while (usados.includes(nuevoId.toString())) {
          nuevoId++;
        }

        await set(ref(db, 'comentarios/' + nuevoId), {
          meta: "seccion creada"
        });

        const iframeUrl = `https://mrmorcilla.github.io/commen/iframe/a.html?id=${nuevoId}`;
        const iframeCode = `<iframe src="${iframeUrl}" width="100%" height="500"></iframe>`;

        resultadoDiv.innerHTML = `
          <p><strong>ID asignado:</strong> ${nuevoId}</p>
          <p>Usa este iframe en tu sitio:</p>
          <code id="codigoIframe">${iframeCode}</code>
          <button onclick="copiarIframe()">üìã Copiar c√≥digo</button>
        `;

        window.iframeCode = iframeCode;
      } catch (error) {
        console.error(error);
        resultadoDiv.innerHTML = "‚ùå Error al generar ID. Intenta nuevamente.";
      }
    }

    function copiarIframe() {
      navigator.clipboard.writeText(window.iframeCode)
        .then(() => alert("‚úÖ Iframe copiado al portapapeles"))
        .catch(err => alert("‚ùå Error al copiar: " + err));
    }

    // Hacemos p√∫blicas las funciones
    window.generarNuevaSeccion = generarNuevaSeccion;
    window.copiarIframe = copiarIframe;
  </script>
</body>
</html>
